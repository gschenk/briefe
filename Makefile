# target
T=brief
TARGET=$(addsuffix .pdf,$(T))

# file containing the recipient
# auto generated by a python3 script
RECIPIENT=private/recipient.lco

# the python3 script that generates from yaml address
# entries latex KOMA variables for the recipient
ADSCR = readAddress.py

# configuration
STY = mydefs.sty mylanguage.sty

LCO = layout.lco german.lco english.lco DIN5008A.lco

# objects
SRC =$(addsuffix .tex,$(T))

OBJ = $(SRC)
OBJ+= private/sender.lco
OBJ+= $(RECIPIENT)
OBJ+= $(LCO)


# tex parser
TEX= pdflatex
TEXFLAGS=

# pdf viewer, fallback to ghostview
ifeq (, $(shell which evince))
  VIEWER:= gv
  VFLAGS:=
else
  VIEWER:= evince
  VFLAGS:=
endif


.PHONY: all clean cleaner view newrec

all: text

text:$(TARGET)

$(TARGET):$(OBJ) $(STY)
	$(TEX) -draftmode $(T)
	$(TEX) $(T)

$(RECIPIENT):$(SRC) $(ADSCR)
	python3 $(ADSCR) `head -n 1 $<` > $@

cleaner: clean
	rm -f *.pdf *.log rm private/recipient.lco

clean:
	rm -f *.dvi *.aux *.out private/recipient.lco

newrec:
	python3 enterAddress.py

view:
	test -e $(TARGET) && $(VIEWER) $(VFLAGS) $(TARGET) 2> /dev/null &

